/*! Social Likes v2.0.13 by Artem Sapegin - http://sapegin.github.com/social-likes - Licensed MIT */
(function(c){"function"===typeof define&&define.amd?define(["jquery"],c):c(jQuery)})(function(c){function q(a){this.container=a;this.init()}function r(a,b){this.widget=a;this.options=c.extend({},b);this.detectService();this.service&&this.init()}function h(a,b,d){return a.replace(/\{([^\}]+)\}/g,function(a,c){return c in b?d?d(b[c]):b[c]:a})}function l(a,b){var d=n+a;return d+" "+d+"_"+b}function s(a){function b(e){"keydown"===e.type&&27!==e.which||c(e.target).closest(a).length||(a.fadeOut(p),d.off(f,
b))}var d=c(document),f="click touchstart keydown";d.on(f,b)}var n="social-likes__",p="fast",k={facebook:{counterUrl:"http://graph.facebook.com/fql?q=SELECT+total_count+FROM+link_stat+WHERE+url%3D%22{url}%22&callback=?",convertNumber:function(a){return a.data[0].total_count},popupUrl:"http://www.facebook.com/sharer/sharer.php?u={url}",popupWidth:600,popupHeight:500},twitter:{counterUrl:"http://urls.api.twitter.com/1/urls/count.json?url={url}&callback=?",convertNumber:function(a){return a.count},popupUrl:"http://twitter.com/intent/tweet?url={url}&text={title}",
popupWidth:600,popupHeight:450,click:function(){/[\.:\-\u2013\u2014]\s*$/.test(this.options.pageTitle)||(this.options.pageTitle+=":");return!0},searchUrl:"https://twitter.com/search?src=typd&q={url}"},mailru:{counterUrl:"http://connect.mail.ru/share_count?url_list={url}&callback=1&func=?",convertNumber:function(a){for(var b in a)if(a.hasOwnProperty(b))return a[b].shares},popupUrl:"http://connect.mail.ru/share?share_url={url}&title={title}",popupWidth:550,popupHeight:360},vkontakte:{counterUrl:"http://vkontakte.ru/share.php?act=count&url={url}&index={index}",
counter:function(a,b){var d=k.vkontakte;d._||(d._=[],window.VK||(window.VK={}),window.VK.Share={count:function(a,b){d._[a].resolve(b)}});var f=d._.length;d._.push(b);c.ajax({url:h(a,{index:f},encodeURIComponent),dataType:"jsonp"})},popupUrl:"http://vk.com/share.php?url={url}&title={title}",popupWidth:550,popupHeight:330,searchUrl:"http://vk.com/feed?section=search&q=url%3A{url}"},odnoklassniki:{counterUrl:"http://www.odnoklassniki.ru/dk?st.cmd=shareData&ref={url}&cb=?",convertNumber:function(a){return a.count},
popupUrl:"http://www.odnoklassniki.ru/dk?st.cmd=addShare&st._surl={url}",popupWidth:550,popupHeight:360},plusone:{popupUrl:"https://plus.google.com/share?url={url}",popupWidth:700,popupHeight:500},livejournal:{click:function(a){a=this._livejournalForm;a||(a=this.options.pageHtml.replace(/&/g,"&amp;").replace(/"/g,"&quot;"),a=c(h('<form action="http://www.livejournal.com/update.bml" method="post" target="_blank" accept-charset="UTF-8"><input type="hidden" name="mode" value="full"><input type="hidden" name="subject" value="{title}"><input type="hidden" name="event" value="{html}"></form>',
{title:this.options.pageTitle,html:a})),this.widget.append(a),this._livejournalForm=a);a.submit()}},pinterest:{counterUrl:"http://api.pinterest.com/v1/urls/count.json?url={url}&callback=?",convertNumber:function(a){return a.count},popupUrl:"http://pinterest.com/pin/create/button/?url={url}&description={title}",popupWidth:630,popupHeight:270}},m={promises:{},fetch:function(a,b,d){m.promises[a]||(m.promises[a]={});var f=m.promises[a];if(!f[b]){var e=c.extend({},k[a],d),g=c.Deferred();a=e.counterUrl&&
h(e.counterUrl,{url:b},encodeURIComponent);c.isFunction(e.counter)?e.counter(a,g):e.counterUrl&&c.getJSON(a).done(function(a){try{var b=a;c.isFunction(e.convertNumber)&&(b=e.convertNumber(a));g.resolve(b)}catch(d){g.reject(d)}});f[b]=g.promise()}return f[b]}};c.fn.socialLikes=function(){return this.each(function(){new q(c(this))})};q.prototype={optionsMap:{pageUrl:{attr:"url",defaultValue:function(){return window.location.href.replace(window.location.hash,"")}},pageTitle:{attr:"title",defaultValue:function(){return document.title}},
pageHtml:{attr:"html",defaultValue:function(){return'<a href="'+this.options.pageUrl+'">'+this.options.pageTitle+"</a>"}},pageCounters:{attr:"counters",defaultValue:"yes",convert:function(a){return"yes"===a}}},init:function(){this.container.addClass("social-likes");this.readOptions();this.single=this.container.hasClass("social-likes_single");this.initUserButtons();this.single&&this.makeSingleButton();var a=this.options;this.container.find("li").each(function(){new r(c(this),a)})},readOptions:function(){this.options=
{};for(var a in this.optionsMap){var b=this.optionsMap[a];this.options[a]=this.container.data(b.attr)||(c.isFunction(b.defaultValue)?c.proxy(b.defaultValue,this)():b.defaultValue);c.isFunction(b.convert)&&(this.options[a]=b.convert(this.options[a]))}},initUserButtons:function(){!this.userButtonInited&&window.socialLikesButtons&&c.extend(k,socialLikesButtons);this.userButtonInited=!0},makeSingleButton:function(){var a=this.container;a.addClass("social-likes_vertical");a.wrap(c("<div>",{"class":"social-likes_single-w"}));
var b=a.parent(),d=parseInt(a.css("left"),10),f=parseInt(a.css("top"),10);a.hide();var e=c("<div>",{"class":l("button","single"),text:a.data("single-title")||"Share"});e.prepend(c("<span>",{"class":l("icon","single")}));b.append(e);var g=c("<li>",{"class":n+"close",html:"&times;"});a.append(g);this.number=0;e.click(function(){a.css({left:d,top:f});if(document.documentElement.getBoundingClientRect){var b=parseInt(a.css("left"),10),c=parseInt(a.css("top"),10);a.css("visibility","hidden").show();var e=
a[0].getBoundingClientRect();20>e.left?a.css("left",20-e.left+b):e.right>window.innerWidth-20&&a.css("left",window.innerWidth-e.right-20+b);20>e.top?a.css("top",20-e.top+c):e.bottom>window.innerHeight-20&&a.css("top",window.innerHeight-e.bottom-20+c);a.hide().css("visibility","visible")}a.fadeIn(p);s(a);return!1});g.click(function(){a.fadeOut(p)});this.wrapper=b;this.container.on("counter.social-likes",c.proxy(this.updateCounter,this))},updateCounter:function(a,b,d){d&&(this.number+=d,this.getCounterElem().text(this.number))},
getCounterElem:function(){var a=this.wrapper.find("."+n+"counter_single");a.length||(a=c("<span>",{"class":l("counter","single")}),this.wrapper.append(a));return a}};r.prototype={init:function(){this.detectParams();this.initHtml();this.options.pageCounters&&(this.options.counterNumber?this.updateCounter(this.options.counterNumber):m.fetch(this.service,this.options.pageUrl,this.options.counterUrl?{counterUrl:this.options.counterUrl}:{}).done(c.proxy(this.updateCounter,this)))},detectService:function(){for(var a=
this.widget[0].classList||this.widget[0].className.split(" "),b=0;b<a.length;b++){var d=a[b];if(k[d]){this.service=d;c.extend(this.options,k[d]);break}}},detectParams:function(){var a=this.widget.data("counter");if(a){var b=parseInt(a,10);isNaN(b)?this.options.counterUrl=a:this.options.counterNumber=b}if(a=this.widget.data("title"))this.options.pageTitle=a;if(a=this.widget.data("url"))this.options.pageUrl=a},initHtml:function(){var a=this.options,b=this.widget,d=!!a.clickUrl;b.removeClass(this.service);
b.addClass(this.getElementClassNames("widget"));var f=b.find("a");f.length&&this.cloneDataAttrs(f,b);f=c(d?"<a>":"<span>",{"class":this.getElementClassNames("button"),text:b.text()});d?(a=h(a.clickUrl,{url:a.pageUrl,title:a.pageTitle},encodeURIComponent),f.attr("href",a)):f.click(c.proxy(this.click,this));f.prepend(c("<span>",{"class":this.getElementClassNames("icon")}));b.empty().append(f);this.button=f},cloneDataAttrs:function(a,b){var d=a.data(),c;for(c in d)d.hasOwnProperty(c)&&b.data(c,d[c])},
getElementClassNames:function(a){return l(a,this.service)},updateCounter:function(a){if(a=parseInt(a,10)){var b=this.options.searchUrl?h(this.options.searchUrl,{url:this.options.pageUrl},encodeURIComponent):null,b=c(this.options.searchUrl?"<a>":"<span>",{"class":this.getElementClassNames("counter"),text:a,href:b});this.widget.append(b);this.widget.trigger("counter.social-likes",[this.service,a])}},click:function(a){var b=this.options,d=!0;c.isFunction(b.click)&&(d=b.click.call(this,a));d&&(a=h(b.popupUrl,
{url:b.pageUrl,title:b.pageTitle},encodeURIComponent),a=this.addAdditionalParamsToUrl(a),this.openPopup(a,{width:b.popupWidth,height:b.popupHeight}));return!1},addAdditionalParamsToUrl:function(a){var b=c.param(this.widget.data());if(!b)return a;var d=-1===a.indexOf("?")?"?":"&";return a+d+b},openPopup:function(a,b){var c=0,f=0,e=void 0!=window.screenTop?window.screenTop:screen.top,c=Math.round(screen.width/2-b.width/2+(void 0!=window.screenLeft?window.screenLeft:screen.left));screen.height>b.height&&
(f=Math.round(screen.height/2-b.height/2+e));(c=window.open(a,"sl_"+this.service,"left="+c+",top="+f+",width="+b.width+",height="+b.height+",personalbar=0,toolbar=0,scrollbars=1,resizable=1"))?c.focus():location.href=a}};c(function(){c(".social-likes").socialLikes()})});